-- 系统用户表
CREATE TABLE `user` (
`id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
`username` VARCHAR(50) NOT NULL UNIQUE COMMENT '登录用户名',
`password` VARCHAR(255) NOT NULL COMMENT '加密后的密码',
`phone` VARCHAR(20) UNIQUE COMMENT '手机号',
`email` VARCHAR(100) UNIQUE COMMENT '邮箱',
`role` VARCHAR(20) NOT NULL COMMENT '角色：USER / MERCHANT / DESIGNER / INSPECTOR / ADMIN',
`status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0-禁用 1-正常 2-注销',
`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
`updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统用户表';

-- 房屋基础信息
CREATE TABLE house (
house_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '房屋主键',
user_id BIGINT NOT NULL COMMENT '所属用户',
city VARCHAR(50) NOT NULL COMMENT '所在城市（影响设计规范、报价）',
community_name VARCHAR(100) COMMENT '小区名称',
building_no VARCHAR(20) COMMENT '楼栋号',
unit_no VARCHAR(20) COMMENT '单元号',
room_no VARCHAR(20) COMMENT '门牌号',
area DECIMAL(6,2) NOT NULL COMMENT '建筑面积（㎡）',
layout_type VARCHAR(50) COMMENT '户型描述（如 2室1厅1卫）',
floor_count INT COMMENT '总层数',
decoration_type VARCHAR(20) COMMENT '装修类型（full / half / loose）',
created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
CONSTRAINT fk_house_user FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='房屋基础信息表';

-- 房屋布局信息
CREATE TABLE house_layout (
layout_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '布局主键',
house_id BIGINT NOT NULL COMMENT '所属房屋',
layout_intent VARCHAR(20) COMMENT '布局意图（KEEP_ORIGINAL / REDESIGN）',
redesign_notes VARCHAR(255) COMMENT '改造需求说明',
layout_version VARCHAR(20) COMMENT '布局版本号（v1 / v2）',
layout_status VARCHAR(20) COMMENT '房屋空间布局状态：draft / confirmed',
created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
CONSTRAINT fk_layout_house FOREIGN KEY (house_id) REFERENCES house(house_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='房屋布局信息表';

-- 房间信息表（HouseRoom）
CREATE TABLE house_room (
room_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '房间主键',
layout_id BIGINT NOT NULL COMMENT '所属布局方案（Layout = CONFIRMED 后有效）',
designer_id BIGINT NOT NULL COMMENT '上传该房间方案的设计师ID',
floor_no INT COMMENT '所在楼层（1 / 2 / 3）',
room_type VARCHAR(20) COMMENT '空间类型（bedroom / living_room / kitchen / bathroom）',
room_name VARCHAR(50) COMMENT '空间名称（主卧 / 次卧 / 客厅）',
area DECIMAL(6,2) COMMENT '空间面积（㎡）',
has_window BOOLEAN COMMENT '是否有窗',
has_balcony BOOLEAN COMMENT '是否带阳台',
notes VARCHAR(255) COMMENT '用户补充说明',
CONSTRAINT fk_room_layout FOREIGN KEY (layout_id) REFERENCES house_layout(layout_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='房间信息表';


CREATE TABLE furniture_scheme (
scheme_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '家具设计方案主键',
room_id BIGINT NOT NULL COMMENT '所属房间',
designer_id BIGINT NOT NULL COMMENT '设计师ID',
scheme_status VARCHAR(20) COMMENT '状态：draft / submitted / confirmed',
scheme_version VARCHAR(20) COMMENT '方案版本号（v1 / v2 / v3）',
created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
CONSTRAINT fk_scheme_room
FOREIGN KEY (room_id)
REFERENCES house_room(room_id)
ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='家具设计方案表（房间级）';

CREATE TABLE furniture_image (
image_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '家具设计图ID',
scheme_id BIGINT NOT NULL COMMENT '所属家具设计方案',
image_url VARCHAR(255) NOT NULL COMMENT '图片地址',
image_type VARCHAR(20) COMMENT 'DESIGN / CONFIRMED',
created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT fk_image_scheme
FOREIGN KEY (scheme_id)
REFERENCES furniture_scheme(scheme_id)
ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='家具设计图片表';


-- 布局或设计图片
CREATE TABLE house_layout_image (
id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '图片主键',
layout_id BIGINT NOT NULL COMMENT '所属布局方案',
image_url VARCHAR(255) COMMENT '户型图/布局图地址',
image_type VARCHAR(20) COMMENT '图片类型（ORIGINAL / STRUCTURE / FURNITURE）',
image_desc VARCHAR(255) COMMENT '图片说明',
created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
CONSTRAINT fk_image_layout FOREIGN KEY (layout_id) REFERENCES house_layout(layout_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='布局/设计图片表';

-- 通用账单表
CREATE TABLE `bill` (
`id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '账单ID',
`biz_type` VARCHAR(20) NOT NULL COMMENT '业务类型：LAYOUT / FURNITURE / CONSTRUCTION',
`biz_id` BIGINT NULL COMMENT '关联业务对象ID，可为空',
`amount` DECIMAL(10,2) NOT NULL COMMENT '本阶段金额',
`paid` TINYINT NOT NULL DEFAULT 0 COMMENT '是否支付：0-未支付 1-已支付',
`payer_id` BIGINT NOT NULL COMMENT '支付方用户ID',
`payee_id` BIGINT NOT NULL COMMENT '收款方用户ID（平台/设计师/商家）',
`created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '账单生成时间',
`paid_at` DATETIME NULL COMMENT '支付时间，由支付时填写',
`remark` VARCHAR(255) NULL COMMENT '备注或说明'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='通用账单表';


-- 聊天消息表
CREATE TABLE `chat_message` (
`id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '消息ID',
`sender_id` BIGINT NOT NULL COMMENT '发送者用户ID',
`receiver_id` BIGINT NOT NULL COMMENT '接收者用户ID',
`content` VARCHAR(1000) NOT NULL COMMENT '消息内容',
`content_type` VARCHAR(20) NOT NULL DEFAULT 'TEXT' COMMENT '消息类型：TEXT / IMAGE / FILE / LINK',
`timestamp` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '发送时间',
CONSTRAINT `fk_chat_sender` FOREIGN KEY (`sender_id`) REFERENCES `user`(`id`) ON DELETE CASCADE,
CONSTRAINT `fk_chat_receiver` FOREIGN KEY (`receiver_id`) REFERENCES `user`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户聊天消息表';
